# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## å°ˆæ¡ˆæ¦‚è¿°

é€™æ˜¯ä¸€å€‹åœ–åƒé¡Œç›®æå–ç³»çµ±ï¼Œä½¿ç”¨ OpenRouter çš„ Qwen3 VL è¦–è¦ºæ¨¡å‹å¾åœ–ç‰‡ä¸­è­˜åˆ¥é¡Œç›®å’Œé¸é …ï¼Œä¸¦æä¾› tkinter GUI é€²è¡Œé¡Œç›®ç®¡ç†ã€‚

**é‡è¦**: æ‰€æœ‰ç¨‹å¼ç¢¼ã€è¨»é‡‹ã€UIæ–‡å­—ã€è¨Šæ¯éƒ½å¿…é ˆä½¿ç”¨**ç¹é«”ä¸­æ–‡**ã€‚

## å¿«é€Ÿé–‹å§‹

```bash
# å®‰è£ä¾è³´
pip install -r requirements.txt

# å•Ÿå‹•æ‡‰ç”¨ç¨‹å¼
python main.py
```

## ä¾è³´åº«

- `requests`: OpenRouter API é€šè¨Š
- `Pillow`: åœ–ç‰‡è™•ç†å’Œç¸®æ”¾ï¼ˆè‡ªå‹•ç¸®æ”¾ã€æ ¼å¼è½‰æ›ï¼‰
- `tkinter`: GUI ç•Œé¢ï¼ˆPython å…§å»ºï¼‰

## æ ¸å¿ƒæ¶æ§‹

### ä¸‰å±¤æ¶æ§‹è¨­è¨ˆ

1. **API å±¤** (`api_client.py`)
   - `OpenRouterClient`: è™•ç†èˆ‡ OpenRouter API çš„æ‰€æœ‰é€šè¨Š
   - è² è²¬åœ–ç‰‡ base64 ç·¨ç¢¼å’Œè¦–è¦ºæ¨¡å‹èª¿ç”¨
   - ä½¿ç”¨çµæ§‹åŒ– prompt ç¢ºä¿ AI è¼¸å‡º JSON æ ¼å¼

2. **è³‡æ–™å±¤** (`question_database.py`)
   - `QuestionDatabase`: ç®¡ç†é¡Œç›®çš„ CRUD æ“ä½œ
   - ä½¿ç”¨ JSON æª”æ¡ˆæŒä¹…åŒ–å„²å­˜
   - è™•ç†é¡Œåº«åŒ¯å…¥æ™‚çš„ ID é‡æ–°åˆ†é…é‚è¼¯
   - **Hash å»é‡ç³»çµ±**: è‡ªå‹•è­˜åˆ¥ä¸¦é˜²æ­¢é‡è¤‡é¡Œç›®ï¼ˆå¿½ç•¥é¸é …é †åºï¼‰
   - **è¿‘ä¼¼æ¯”å°ç³»çµ±**: ä½¿ç”¨ difflib è¨ˆç®—ç›¸ä¼¼åº¦ï¼Œå¯é…ç½®é–¾å€¼å’Œæ¬Šé‡
   - **æ¨™é»ç¬¦è™Ÿæ­£è¦åŒ–**: æ™ºæ…§åµæ¸¬ä¸­æ–‡èªå¢ƒï¼Œè‡ªå‹•çµ±ä¸€æ¨™é»ç¬¦è™Ÿæ ¼å¼
   - **åœ–ç‰‡ç®¡ç†**: è‡ªå‹•å„²å­˜å’Œç®¡ç†é¡Œç›®ç›¸é—œåœ–ç‰‡

3. **UI å±¤** (`main.py`)
   - `QuestionExtractorApp`: tkinter GUI æ‡‰ç”¨ç¨‹å¼
   - ä½¿ç”¨èƒŒæ™¯åŸ·è¡Œç·’è™•ç†åœ–ç‰‡ï¼Œé¿å… UI å‡çµ
   - æ§åˆ¶é¢æ¿åˆ†ç‚ºä¸‰å€ï¼šæª”æ¡ˆæ“ä½œã€åœ–ç‰‡è™•ç†ã€é¡Œåº«ç®¡ç†
   - **æ‰¹é‡ç­”é¡ŒåŠŸèƒ½**: `BatchAnswerDialog` æ‰¹é‡èª¿ç”¨ AI ç”Ÿæˆç­”æ¡ˆ
   - **æ‰¹é‡è§£é¡ŒåŠŸèƒ½**: `BatchGenerateNoteDialog` æ‰¹é‡ç”Ÿæˆé¡Œç›®è§£æ
   - **å…¨å±€è¨­å®š**: `GlobalSettingsDialog` çµ±ä¸€ç®¡ç†æ‡‰ç”¨ç¨‹å¼è¨­å®š
   - **åœ–ç‰‡é—œéµå­—åµæ¸¬**: è‡ªå‹•è­˜åˆ¥é¡Œç›®ä¸­çš„åœ–ç‰‡ç›¸é—œé—œéµå­—

### è³‡æ–™çµæ§‹

é¡Œç›®è³‡æ–™æ ¼å¼ï¼ˆJSONï¼‰:
```json
{
  "id": 1,
  "question": "é¡Œç›®å…§å®¹",
  "question_hash": "é¡Œç›®å…§å®¹çš„ MD5 hash",
  "options": {
    "A": "é¸é …A",
    "B": "é¸é …B",
    "C": "é¸é …C",
    "D": "é¸é …D"
  },
  "options_hash": "é¸é …å…§å®¹çš„ MD5 hashï¼ˆå¿½ç•¥é †åºï¼‰",
  "combined_hash": "é¡Œç›®+é¸é …çš„çµ„åˆ hashï¼ˆç”¨æ–¼å»é‡ï¼‰",
  "correct_answer": "A",  // å¯ç‚º "A", "AB", "ABC" ç­‰å¤šé¸
  "source": "åŸå§‹åœ–ç‰‡è·¯å¾‘",
  "image_path": "å„²å­˜çš„åœ–ç‰‡è·¯å¾‘ï¼ˆimages/hash.jpgï¼‰",
  "created_at": "ISO æ™‚é–“æˆ³"
}
```

**é‡è¦**: é¡Œç›® ID å¾ 1 é–‹å§‹ç·¨è™Ÿï¼Œè€Œé 0ã€‚

## é—œéµå¯¦ä½œç´°ç¯€

### AI Prompt è¨­è¨ˆ
- ä½æ–¼ `api_client.py` çš„ `extract_questions_from_image()`
- Prompt è¦æ±‚ AI è¼¸å‡ºåš´æ ¼çš„ JSON æ ¼å¼
- åŒ…å«å°è¢å¹•é›œè¨Šçš„éæ¿¾æŒ‡ä»¤
- è™•ç† markdown ç¨‹å¼ç¢¼å€å¡Šæ¨™è¨˜çš„æ¸…ç†é‚è¼¯

### é¡Œåº«åˆä½µé‚è¼¯
- `import_from_file()` æœƒé‡æ–°åˆ†é…æ‰€æœ‰åŒ¯å…¥é¡Œç›®çš„ ID
- ä½¿ç”¨ `len(self.questions)` ä½œç‚ºèµ·å§‹ ID
- åŒ¯å…¥çš„é¡Œç›® source æœƒåŠ ä¸Š " (å·²åŒ¯å…¥)" æ¨™è¨˜

### UI è¤‡é¸æ¡†ç‹€æ…‹ç®¡ç†
- æ¯å€‹é¸é … (A-D) æœ‰å°æ‡‰çš„ `tk.BooleanVar()`
- å„²å­˜æ™‚æ”¶é›†æ‰€æœ‰å‹¾é¸çš„é¸é …çµ„æˆå­—ä¸² (å¦‚ "AB")
- è¼‰å…¥æ™‚å°‡å­—ä¸²æ‹†è§£è¨­å®šå„è¤‡é¸æ¡†ç‹€æ…‹

### èƒŒæ™¯åŸ·è¡Œç·’åœ–ç‰‡è™•ç†
- ä½¿ç”¨ `threading.Thread` è™•ç†æ‰¹é‡åœ–ç‰‡
- é€é `root.after(0, callback)` æ›´æ–° UI
- é¿å…åœ¨èƒŒæ™¯åŸ·è¡Œç·’ç›´æ¥æ“ä½œ tkinter å…ƒä»¶

### Hash å»é‡æ©Ÿåˆ¶
- **é¡Œç›® hash**: å°é¡Œç›®æ–‡å­—é€²è¡Œ MD5 hash
- **é¸é … hash**: å°æ‰€æœ‰é¸é …å€¼æ’åºå¾Œé€²è¡Œ hashï¼ˆå¿½ç•¥ A/B/C/D éµé †åºï¼‰
- **çµ„åˆ hash**: é¡Œç›® hash + é¸é … hash çš„çµ„åˆï¼Œä½œç‚ºå”¯ä¸€è­˜åˆ¥
- æ·»åŠ é¡Œç›®æ™‚è‡ªå‹•æª¢æŸ¥ `combined_hash` æ˜¯å¦å·²å­˜åœ¨
- é‡è¤‡é¡Œç›®è¿”å›å·²å­˜åœ¨çš„ IDï¼Œä¸é‡è¤‡æ·»åŠ 
- æ‰¹é‡æ·»åŠ æœƒçµ±è¨ˆæ–°å¢å’Œé‡è¤‡æ•¸é‡

### åœ–ç‰‡ç®¡ç†ç³»çµ±

**åŸºæœ¬åŠŸèƒ½**:
- åœ–ç‰‡å„²å­˜åœ¨ `images/` ç›®éŒ„
- ä½¿ç”¨ `combined_hash` ä½œç‚ºåœ–ç‰‡æª”åï¼ˆçµ±ä¸€ç‚º .jpg æ ¼å¼ï¼‰
- é‡è¤‡é¡Œç›®ä¸æœƒé‡è¤‡å„²å­˜åœ–ç‰‡
- UI ä¸­é¡¯ç¤ºåœ–ç‰‡é€£çµï¼Œé»æ“Šå¯ç”¨ç³»çµ±é è¨­ç¨‹å¼é–‹å•Ÿ
- æ”¯æ´ Windowsã€macOSã€Linux è·¨å¹³å°é–‹å•Ÿåœ–ç‰‡

**è‡ªå‹•ç¸®æ”¾æ©Ÿåˆ¶** (`save_image()` å’Œ `encode_image_to_base64()` æ–¹æ³•):
1. **å°ºå¯¸æª¢æ¸¬**: è¨ˆç®—åœ–ç‰‡çŸ­é‚Šï¼ˆ`min(width, height)`ï¼‰
2. **æ¢ä»¶ç¸®æ”¾**:
   - çŸ­é‚Š > 1200px â†’ ç­‰æ¯”ç¸®å°è‡³çŸ­é‚Š 1200px
   - çŸ­é‚Š â‰¤ 1200px â†’ ä¿æŒåŸå°ºå¯¸
3. **æ¼”ç®—æ³•**: ä½¿ç”¨ `Image.Resampling.LANCZOS`
   - æœ€é©åˆæ–‡å­—å…§å®¹çš„é‡æ¡æ¨£æ¼”ç®—æ³•
   - ä¿æŒé‚Šç·£éŠ³åˆ©ï¼Œä¸æœƒæ¨¡ç³Š
   - å“è³ªå„ªæ–¼ BILINEAR å’Œ BICUBIC
4. **é›™é‡ç¸®æ”¾å„ªåŒ–**:
   - **å„²å­˜æ™‚**: `save_image()` ç¸®æ”¾å¾Œå„²å­˜è‡³ `images/` è³‡æ–™å¤¾
   - **ä¸Šå‚³æ™‚**: `encode_image_to_base64()` åœ¨è¨˜æ†¶é«”ä¸­ç¸®æ”¾å¾Œä¸Šå‚³è‡³ API
   - ç›®çš„: ç¯€çœ API ä¸Šå‚³æ™‚é–“å’Œæˆæœ¬ï¼ŒåŒæ™‚ä¿æŒæœ¬åœ°å„²å­˜æ•ˆç‡

**æ ¼å¼è½‰æ›**:
- è‡ªå‹•å°‡ PNG/RGBA/LA/P æ¨¡å¼è½‰æ›ç‚º RGB
- é€æ˜èƒŒæ™¯æ›¿æ›ç‚ºç™½è‰²èƒŒæ™¯
- çµ±ä¸€å„²å­˜ç‚º JPEG æ ¼å¼ï¼ˆç¯€çœç©ºé–“ï¼‰
- å„²å­˜åƒæ•¸: `quality=95, optimize=True`

**å¯¦éš›æ•ˆæœ**:
- 4K è¢å¹•æˆªåœ– (3840x2160) â†’ ç¸®æ”¾è‡³ 2133x1200
- æª”æ¡ˆå¤§å°å¾ 2-3 MB â†’ 200-400 KBï¼ˆç¯€çœ 80-90%ï¼‰
- API ä¸Šå‚³æµé‡åŒæ¨£æ¸›å°‘ 80-90%
- æ–‡å­—ä¾ç„¶æ¸…æ™°å¯è®€

### è¿‘ä¼¼æ¯”å°ç³»çµ±

**ç›¸ä¼¼åº¦è¨ˆç®—**:
- ä½¿ç”¨ `difflib.SequenceMatcher` è¨ˆç®—é¡Œç›®å’Œé¸é …çš„ç›¸ä¼¼åº¦
- **æ¬Šé‡é…ç½®**: é¡Œç›®å’Œé¸é …åˆ†åˆ¥æœ‰æ¬Šé‡ï¼ˆé è¨­ 0.6 å’Œ 0.4ï¼‰ï¼Œå¯åœ¨ config.json èª¿æ•´
- **é–¾å€¼æ§åˆ¶**: ç›¸ä¼¼åº¦è¶…éé–¾å€¼ï¼ˆé è¨­ 0.75ï¼‰ä½†ä¸å®Œå…¨ç›¸åŒæ™‚è§¸ç™¼æ¯”å°

**ä¸‰ç¨®ç‹€æ…‹**:
- `new`: æ–°é¡Œç›®ï¼Œç›´æ¥æ·»åŠ 
- `duplicate`: å®Œå…¨é‡è¤‡ï¼Œè‡ªå‹•è·³é
- `similar`: è¿‘ä¼¼é¡Œç›®ï¼ŒåŠ å…¥å¾…è™•ç†æ¸…å–®

**éé˜»å¡è™•ç†æ©Ÿåˆ¶**:
1. **å¾…è™•ç†æ¸…å–®**: ä½¿ç”¨ `queue.Queue` å„²å­˜éœ€è¦ä½¿ç”¨è€…æ±ºå®šçš„è¿‘ä¼¼é¡Œç›®
2. **èƒŒæ™¯åŸ·è¡Œç·’**: æŒçºŒ AI åˆ¤è®€ï¼Œç™¼ç¾è¿‘ä¼¼é¡Œç›®æ™‚æ”¾å…¥ queue
3. **ä¸»åŸ·è¡Œç·’**: æ¯ 500ms æª¢æŸ¥ queueï¼ˆ`check_pending_queue()`ï¼‰
4. **å½ˆå‡ºå°è©±æ¡†**: éé˜»å¡ï¼Œä½¿ç”¨è€…è™•ç†æ™‚èƒŒæ™¯ç¹¼çºŒå·¥ä½œ

**æ¯”å°å°è©±æ¡†** (`ComparisonDialog` é¡åˆ¥):
- **é¡¯ç¤ºå…§å®¹**:
  - æ–°èˆŠé¡Œç›®å®Œæ•´å…§å®¹å°æ¯”
  - ç›¸ä¼¼åº¦ç™¾åˆ†æ¯”ï¼ˆç´…è‰² >90%ï¼Œæ©™è‰² <90%ï¼‰
  - æ­£ç¢ºç­”æ¡ˆï¼ˆå¦‚æœå·²å­˜åœ¨é¡Œç›®æœ‰è¨­å®šï¼‰
  - ğŸ“· æŸ¥çœ‹åœ–ç‰‡é€£çµï¼ˆæ¯å€‹é¡Œç›®å¡ç‰‡ï¼‰

- **ä¸‰ç¨®é¸æ“‡**:
  - **ç¢ºèªé¸æ“‡**: å–®é¸æŒ‰éˆ•é¸æ“‡ä¿ç•™å“ªå€‹ç‰ˆæœ¬
  - **å…¨éƒ¨ä¿ç•™ï¼ˆæ–°å¢ï¼‰**: å¼·åˆ¶æ·»åŠ æ–°é¡Œç›®ï¼ˆ`force_add_question()`ï¼‰
  - **è·³é**: æ”¾æ£„æ·»åŠ æ–°é¡Œç›®

- **åœ–ç‰‡é€£çµå¯¦ä½œ**:
  - æ–°é¡Œç›®: ä½¿ç”¨ `self.image_path`ï¼ˆå‰›ä¸Šå‚³çš„åœ–ç‰‡ï¼‰
  - å·²å­˜åœ¨é¡Œç›®: ä½¿ç”¨ `question_data.get('image_path', '')`
  - é»æ“Šå¾Œä½¿ç”¨ç³»çµ±é è¨­ç¨‹å¼é–‹å•Ÿï¼ˆè·¨å¹³å°æ”¯æ´ï¼‰
  - æ–¹ä¾¿ä½¿ç”¨è€…ç›´æ¥æ¯”å°åŸåœ–åˆ¤æ–·å“ªå€‹æ­£ç¢º

### æ¨™é»ç¬¦è™Ÿæ­£è¦åŒ–ç³»çµ±

**æ ¸å¿ƒåŠŸèƒ½** (`normalize_punctuation()` éœæ…‹æ–¹æ³•):
- è‡ªå‹•çµ±ä¸€é¡Œç›®å’Œé¸é …ä¸­çš„æ¨™é»ç¬¦è™Ÿæ ¼å¼
- åœ¨ hash è¨ˆç®—**ä¹‹å‰**åŸ·è¡Œï¼Œç¢ºä¿ç›¸åŒå…§å®¹ä¸å› æ¨™é»å·®ç•°è€Œè¢«åˆ¤å®šç‚ºä¸åŒé¡Œç›®

**ä¸‰ç¨®æ¨¡å¼**:
1. `disabled`: åœç”¨ï¼ˆé è¨­ï¼‰
2. `to_fullwidth`: è½‰æ›ç‚ºå…¨å½¢æ¨™é»ï¼ˆ`,` â†’ `ï¼Œ`ã€`?` â†’ `ï¼Ÿ`ï¼‰
3. `to_halfwidth`: è½‰æ›ç‚ºåŠå½¢æ¨™é»ï¼ˆ`ï¼Œ` â†’ `,`ã€`ï¼Ÿ` â†’ `?`ï¼‰

**æ™ºæ…§ä¸­æ–‡èªå¢ƒåµæ¸¬** (`is_chinese_context()` å…§éƒ¨æ–¹æ³•):
- æª¢æŸ¥æ¨™é»ç¬¦è™Ÿå‰å¾Œ 2 å€‹å­—å…ƒçš„ä¸Šä¸‹æ–‡
- åµæ¸¬æ¢ä»¶:
  - åŒ…å«ä¸­æ—¥éŸ“çµ±ä¸€è¡¨æ„æ–‡å­— (U+4E00-U+9FFF, U+3400-U+4DBF)
  - åŒ…å«ä¸­æ–‡æ¨™é»ç¬¦è™Ÿï¼ˆï¼Œã€‚ï¼ï¼Ÿï¼›ï¼šã€Œã€ã€ã€ç­‰ï¼‰
- åªåœ¨ä¸­æ–‡èªå¢ƒä¸‹è½‰æ›æ¨™é»ï¼Œä¿ç•™å…¶ä»–èªè¨€åŸæ¨£

**ç‰¹æ®Šè™•ç†**:
- **å°æ•¸é»ä¿è­·**: ä¸è½‰æ›æ•¸å­—ä¸­çš„å°æ•¸é»ï¼ˆå¦‚ `3.14`ï¼‰
- **URL ä¿è­·**: ä¸è½‰æ›ç¶²å€ä¸­çš„ç¬¦è™Ÿ
- ä½¿ç”¨æ­£å‰‡è¡¨é”å¼ `\d+\.\d+` åµæ¸¬æ•¸å­—æ ¼å¼

**åŸ·è¡Œæ™‚æ©Ÿ**:
- `add_question()` æ–¹æ³•é–‹é ­ç«‹å³åŸ·è¡Œ
- åœ¨ hash è¨ˆç®—ä¹‹å‰å®Œæˆæ­£è¦åŒ–
- ç¢ºä¿é‡è¤‡åµæ¸¬çš„æº–ç¢ºæ€§

**ç¯„ä¾‹**:
```python
# è¼¸å…¥ï¼ˆæ··åˆæ¨™é»ï¼‰
question = "é€™æ˜¯ä¸€å€‹æ¸¬è©¦,å°å—?"
# è¼¸å‡ºï¼ˆto_fullwidth æ¨¡å¼ï¼‰
question = "é€™æ˜¯ä¸€å€‹æ¸¬è©¦ï¼Œå°å—ï¼Ÿ"

# è¼¸å…¥ï¼ˆä¿ç•™å°æ•¸é»ï¼‰
question = "åœ“å‘¨ç‡ç´„ç‚º3.14,å°å—?"
# è¼¸å‡º
question = "åœ“å‘¨ç‡ç´„ç‚º3.14ï¼Œå°å—ï¼Ÿ"

# è¼¸å…¥ï¼ˆè‹±æ–‡èªå¢ƒä¿ç•™ï¼‰
question = "This is a test, right?"
# è¼¸å‡ºï¼ˆä¸è®Šï¼‰
question = "This is a test, right?"
```

### æ‰¹é‡ç­”é¡Œèˆ‡è§£é¡Œç³»çµ±

**æ‰¹é‡ç­”é¡Œ** (`BatchAnswerDialog` é¡åˆ¥):
- æ‰¹é‡èª¿ç”¨ `AnswerClient` ç‚ºé¡Œç›®ç”Ÿæˆç­”æ¡ˆå’Œè§£æ
- å¯é¸é …:
  - **è·³éå·²ç­”**: è·³éå·²æœ‰ç­”æ¡ˆçš„é¡Œç›®
  - **ç”Ÿæˆè§£æ**: åŒæ™‚ç”Ÿæˆé¡Œç›®è§£æï¼ˆnoteï¼‰
  - **åŒ…å«åœ–ç‰‡**: å°‡é¡Œç›®åœ–ç‰‡ä¸€ä½µç™¼é€çµ¦ AI
  - **æ‰¹æ¬¡å¤§å°**: æ§åˆ¶æ¯æ‰¹è™•ç†çš„é¡Œç›®æ•¸é‡ï¼ˆé è¨­ 10ï¼‰
- é€²åº¦é¡¯ç¤º:
  - å³æ™‚æ—¥èªŒè¼¸å‡ºè™•ç†ç‹€æ…‹
  - é¡¯ç¤ºç­”æ¡ˆå’Œè§£æå…§å®¹
  - çµ±è¨ˆè™•ç†æˆåŠŸ/å¤±æ•—æ•¸é‡
- èƒŒæ™¯åŸ·è¡Œç·’è™•ç†ï¼Œä¸é˜»å¡ UI

**æ‰¹é‡è§£é¡Œ** (`BatchGenerateNoteDialog` é¡åˆ¥):
- å°ˆé–€ç”¨æ–¼æ‰¹é‡ç”Ÿæˆé¡Œç›®è§£æï¼ˆnoteï¼‰
- å¯é¸é …:
  - **è·³éå·²æœ‰è§£æ**: è·³éå·²æœ‰ note çš„é¡Œç›®
  - **è·³éç„¡ç­”æ¡ˆ**: è·³éæœªè¨­å®šç­”æ¡ˆçš„é¡Œç›®
  - **åŒ…å«åœ–ç‰‡**: å°‡é¡Œç›®åœ–ç‰‡ä¸€ä½µç™¼é€çµ¦ AI
  - **æ‰¹æ¬¡å¤§å°**: æ§åˆ¶æ¯æ‰¹è™•ç†çš„é¡Œç›®æ•¸é‡ï¼ˆé è¨­ 10ï¼‰
- åŒæ¨£ä½¿ç”¨èƒŒæ™¯åŸ·è¡Œç·’å’Œå³æ™‚æ—¥èªŒ

**åœ–ç‰‡é—œéµå­—è‡ªå‹•åµæ¸¬** (`contains_image_keywords()` éœæ…‹æ–¹æ³•):
- è‡ªå‹•åµæ¸¬é¡Œç›®ä¸­æ˜¯å¦åŒ…å«åœ–ç‰‡ç›¸é—œé—œéµå­—
- é—œéµå­—åˆ—è¡¨ï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰:
  - ç¹é«”ä¸­æ–‡: åœ–ã€åœ–ç‰‡ã€åœ–åƒã€åœ–è¡¨ã€ç…§ç‰‡ã€æˆªåœ–
  - ç°¡é«”ä¸­æ–‡: å›¾ã€å›¾ç‰‡ã€å›¾åƒã€å›¾è¡¨ã€ç…§ç‰‡ã€æˆªå›¾
  - è‹±æ–‡: image, images, picture, pictures, photo, photos, figure, figures, screenshot, pic, pics
- ç•¶åµæ¸¬åˆ°é—œéµå­—æ™‚ï¼Œè‡ªå‹•å¼·åˆ¶åŒ…å«åœ–ç‰‡ç™¼é€è‡³ AI
- å¯åœ¨å…¨å±€è¨­å®šä¸­é–‹å•Ÿ/é—œé–‰ï¼ˆé è¨­é—œé–‰ï¼‰
- æ—¥èªŒè¼¸å‡º: "åµæ¸¬åˆ°åœ–ç‰‡é—œéµå­—ï¼Œè‡ªå‹•åŒ…å«åœ–ç‰‡"

**éé˜»å¡è™•ç†æµç¨‹**:
1. ä½¿ç”¨è€…é»æ“ŠæŒ‰éˆ•é–‹å•Ÿå°è©±æ¡†
2. è¨­å®šé¸é …å¾Œé»æ“Šã€Œé–‹å§‹è™•ç†ã€
3. èƒŒæ™¯åŸ·è¡Œç·’é–‹å§‹æ‰¹é‡è™•ç†
4. ä¸»è¦–çª—å¯ç¹¼çºŒæ“ä½œ
5. æ—¥èªŒå³æ™‚æ›´æ–°è™•ç†ç‹€æ…‹
6. å®Œæˆå¾Œé¡¯ç¤ºçµ±è¨ˆè³‡è¨Š

### ğŸš€ ä¸€æ°£å‘µæˆç³»çµ±ï¼ˆå¯¦é©—åŠŸèƒ½ï¼‰

**æ ¸å¿ƒæ¦‚å¿µ**:
- åœ¨æ‰¹é‡åœ–ç‰‡è¾¨è­˜å®Œæˆå¾Œï¼Œè‡ªå‹•å•Ÿå‹•ç­”é¡Œ/è§£é¡Œæµç¨‹
- æ¯é“é¡Œç›®ç¨ç«‹è™•ç†ï¼Œä¸å½±éŸ¿ä¸‹ä¸€å¼µåœ–ç‰‡ç¹¼çºŒè¾¨è­˜
- ä½¿ç”¨ä½µè¡Œä»»å‹™ä½‡åˆ—ï¼Œé¿å…è¨˜æ†¶é«”æº¢å‡º

**åŸ·è¡Œæµç¨‹**:
```
è¾¨è­˜1 â†’ è¾¨è­˜2 â†’ è¾¨è­˜3 â†’ è¾¨è­˜4 ...
  â†“       â†“       â†“       â†“
è§£é¡Œ1    è§£é¡Œ2    è§£é¡Œ3    è§£é¡Œ4 ...
  â†“       â†“       â†“       â†“
[ä½µè¡Œä»»å‹™ä½‡åˆ—ï¼Œæœ€å¤šåŒæ™‚åŸ·è¡Œ N å€‹]
```

**ä½µè¡Œä»»å‹™ç®¡ç†** (`QuestionExtractorApp` é¡åˆ¥):
- `oneshot_task_queue`: å¾…è™•ç†çš„é¡Œç›®ä½‡åˆ—ï¼ˆ`queue.Queue`ï¼‰
- `oneshot_active_tasks`: ç•¶å‰æ´»èºçš„ä»»å‹™æ•¸é‡
- `oneshot_lock`: åŸ·è¡Œç·’é–ï¼ˆ`threading.Lock`ï¼‰ï¼Œä¿è­·ä»»å‹™è¨ˆæ•¸å™¨
- `oneshot_total_processed/success/failed`: çµ±è¨ˆè³‡è¨Š

**æ ¸å¿ƒæ–¹æ³•**:
1. **`check_oneshot_queue()`**: å®šæœŸæª¢æŸ¥ä»»å‹™ä½‡åˆ—ä¸¦å•Ÿå‹•è™•ç†
   - æ¯ 500ms æª¢æŸ¥ä¸€æ¬¡
   - æª¢æŸ¥ç•¶å‰æ´»èºä»»å‹™æ•¸æ˜¯å¦å°æ–¼æœ€å¤§ä½µè¡Œæ•¸
   - å¾ä½‡åˆ—å–å‡ºä»»å‹™ä¸¦å•Ÿå‹•èƒŒæ™¯åŸ·è¡Œç·’

2. **`process_oneshot_task(task_data)`**: è™•ç†å–®ä¸€ä»»å‹™ï¼ˆèƒŒæ™¯åŸ·è¡Œç·’ï¼‰
   - ç²å–é¡Œç›®è³‡æ–™
   - æ ¹æ“š action åŸ·è¡Œç­”é¡Œ/è§£é¡Œ
   - æ›´æ–°çµ±è¨ˆè³‡è¨Š
   - é‡‹æ”¾ä»»å‹™æ§½

3. **`oneshot_generate_answer(question_data, include_image)`**: ç”Ÿæˆç­”æ¡ˆ
   - æª¢æŸ¥æ˜¯å¦è·³éå·²ç­”é¡Œç›®
   - è‡ªå‹•åµæ¸¬åœ–ç‰‡é—œéµå­—
   - èª¿ç”¨ `AnswerClient.answer_single_question()`
   - æ›´æ–°è³‡æ–™åº«

4. **`oneshot_generate_note(question_data, include_image)`**: ç”Ÿæˆè§£æ
   - æª¢æŸ¥æ˜¯å¦æœ‰ç­”æ¡ˆï¼ˆæ²’æœ‰ç­”æ¡ˆå‰‡è·³éï¼‰
   - æª¢æŸ¥æ˜¯å¦å·²æœ‰è§£æï¼ˆæœ‰è§£æå‰‡è·³éï¼‰
   - è‡ªå‹•åµæ¸¬åœ–ç‰‡é—œéµå­—
   - èª¿ç”¨ `AnswerClient.generate_note_for_question()`
   - æ›´æ–°è³‡æ–™åº«

**æ•´åˆåˆ°åœ–ç‰‡è™•ç†æµç¨‹** (`process_images()` æ–¹æ³•):
- è¾¨è­˜å®Œæˆå¾Œï¼Œå¦‚æœå•Ÿç”¨ä¸€æ°£å‘µæˆæ¨¡å¼
- å°‡æ–°å¢çš„é¡Œç›®åŠ å…¥ `oneshot_task_queue`
- ä»»å‹™è³‡æ–™åŒ…å«: `question_id`, `action`, `include_image`
- èƒŒæ™¯ä½‡åˆ—è™•ç†å™¨æœƒè‡ªå‹•é–‹å§‹è™•ç†

**ä½µè¡Œé™åˆ¶æ©Ÿåˆ¶**:
- ä½¿ç”¨ `threading.Lock` ä¿è­·ä»»å‹™è¨ˆæ•¸å™¨
- æœ€å¤§ä½µè¡Œæ•¸å¯è¨­å®šï¼ˆ1-10ï¼Œé è¨­ 3ï¼‰
- ä»»å‹™å®Œæˆå¾Œè‡ªå‹•é‡‹æ”¾æ§½ä½
- é¿å…åŒæ™‚ç™¼é€éå¤š API è«‹æ±‚å°è‡´è¨˜æ†¶é«”æº¢å‡º

**ä½¿ç”¨å ´æ™¯**:
- æ‰¹é‡åœ–ç‰‡è¾¨è­˜å¾Œéœ€è¦è‡ªå‹•ç­”é¡Œ
- æƒ³è¦ä¸€æ¬¡å®Œæˆè¾¨è­˜+ç­”é¡Œ+è§£é¡Œ
- éœ€è¦é«˜æ•ˆç‡è™•ç†å¤§é‡é¡Œç›®

**æ³¨æ„äº‹é …**:
- ä½µè¡Œæ•¸å»ºè­°è¨­å®šç‚º 3-5ï¼Œè¦–é›»è…¦æ•ˆèƒ½å’Œ API é™åˆ¶èª¿æ•´
- è·³éå·²ç­”é¸é …é¿å…é‡è¤‡æµªè²» API è«‹æ±‚
- è‡ªå‹•åµæ¸¬åœ–ç‰‡é—œéµå­—å¯æé«˜ç­”é¡Œæº–ç¢ºåº¦

### å…¨å±€è¨­å®šç³»çµ±

**å…¨å±€è¨­å®šå°è©±æ¡†** (`GlobalSettingsDialog` é¡åˆ¥):
- çµ±ä¸€ç®¡ç†æ‡‰ç”¨ç¨‹å¼å…¨å±€è¨­å®š
- è¨­å®šå…§å®¹å„²å­˜è‡³ `config.json`
- ä¿®æ”¹å¾Œç«‹å³ç”Ÿæ•ˆï¼ˆéƒ¨åˆ†éœ€é‡å•Ÿç¨‹å¼ï¼‰

**ç•¶å‰è¨­å®šé …ç›®**:

1. **æ¨™é»ç¬¦è™Ÿè‡ªå‹•æ•´ç†**:
   - ä¸‰é¸ä¸€: åœç”¨ / è½‰å…¨å½¢ / è½‰åŠå½¢
   - å½±éŸ¿ç¯„åœ: æ‰€æœ‰æ–°å¢é¡Œç›®
   - åŸ·è¡Œæ™‚æ©Ÿ: hash è¨ˆç®—ä¹‹å‰
   - é‡å•Ÿå¾Œç”Ÿæ•ˆï¼ˆè³‡æ–™åº«åˆå§‹åŒ–æ™‚è®€å–ï¼‰

2. **åœ–ç‰‡è‡ªå‹•åµæ¸¬**:
   - æ ¸å–æ–¹å¡Š: è‡ªå‹•åµæ¸¬é¡Œç›®ä¸­çš„åœ–ç‰‡é—œéµå­—
   - å½±éŸ¿ç¯„åœ: æ‰¹é‡ç­”é¡Œå’Œæ‰¹é‡è§£é¡Œ
   - ç«‹å³ç”Ÿæ•ˆï¼ˆä¸éœ€é‡å•Ÿï¼‰

3. **ğŸš€ ä¸€æ°£å‘µæˆï¼ˆå¯¦é©—åŠŸèƒ½ï¼‰**:
   - æ ¸å–æ–¹å¡Š: å•Ÿç”¨/åœç”¨ä¸€æ°£å‘µæˆæ¨¡å¼
   - è¾¨è­˜å¾Œå‹•ä½œ: åƒ…ç­”é¡Œ / åƒ…è§£é¡Œ / ç­”é¡Œ+è§£é¡Œ
   - è·³éå·²ç­”: è·³éå·²æœ‰ç­”æ¡ˆçš„é¡Œç›®
   - åŒ…å«åœ–ç‰‡: è‡ªå‹•ç™¼é€åœ–ç‰‡çµ¦ AI
   - æœ€å¤§ä½µè¡Œä»»å‹™æ•¸: 1-10ï¼ˆé è¨­ 3ï¼‰
   - å½±éŸ¿ç¯„åœ: æ‰¹é‡åœ–ç‰‡è¾¨è­˜æµç¨‹
   - ç«‹å³ç”Ÿæ•ˆï¼ˆä¸éœ€é‡å•Ÿï¼‰

**UI è¨­è¨ˆ**:
- ä½¿ç”¨ `ttk.LabelFrame` åˆ†çµ„é¡¯ç¤ºä¸åŒé¡åˆ¥è¨­å®š
- å–®é¸æŒ‰éˆ• (`ttk.Radiobutton`) ç”¨æ–¼äº’æ–¥é¸é …
- æ ¸å–æ–¹å¡Š (`ttk.Checkbutton`) ç”¨æ–¼é–‹é—œé¸é …
- æ•¸å­—é¸æ“‡å™¨ (`ttk.Spinbox`) ç”¨æ–¼ä½µè¡Œæ•¸é‡
- è¦–çª—å°ºå¯¸: 500x500ï¼ˆç¢ºä¿æ‰€æœ‰å…§å®¹å¯è¦‹ï¼‰
- æ¨¡æ…‹è¦–çª—: ä½¿ç”¨ `grab_set()` ç¢ºä¿ä½¿ç”¨è€…å®Œæˆè¨­å®š
- å‹•æ…‹å•Ÿç”¨/åœç”¨: ä¸€æ°£å‘µæˆé¸é …æ ¹æ“šä¸»é–‹é—œè‡ªå‹•åˆ‡æ›ç‹€æ…‹

## é…ç½®æª”æ¡ˆ

### config.json
```json
{
  "openrouter_api_key": "sk-or-v1-...",
  "model": "qwen/qwen3-vl-235b-a22b-instruct",
  "site_url": "http://localhost",
  "site_name": "Question Extractor",
  "similarity_threshold": 0.75,
  "question_weight": 0.6,
  "options_weight": 0.4,
  "punctuation_mode": "disabled",
  "auto_detect_image_keywords": false,
  "one_shot_mode_enabled": false,
  "one_shot_action": "answer",
  "one_shot_skip_answered": true,
  "one_shot_include_image": true,
  "one_shot_max_concurrent": 3
}
```

- API é‡‘é‘°ä¸æ‡‰æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- æä¾› `config.example.json` ä½œç‚ºæ¨¡æ¿

**åƒæ•¸èªªæ˜**:

- **ç›¸ä¼¼åº¦åƒæ•¸**:
  - `similarity_threshold`: 0.0-1.0ï¼Œè¶Šé«˜è¶Šåš´æ ¼ï¼ˆé è¨­ 0.75ï¼‰
  - `question_weight`: é¡Œç›®ç›¸ä¼¼åº¦æ¬Šé‡ï¼ˆé è¨­ 0.6ï¼‰
  - `options_weight`: é¸é …ç›¸ä¼¼åº¦æ¬Šé‡ï¼ˆé è¨­ 0.4ï¼‰
  - `question_weight` + `options_weight` æ‡‰ç­‰æ–¼ 1.0
  - é€™äº›åƒæ•¸åœ¨è³‡æ–™åº«åˆå§‹åŒ–æ™‚è®€å–ï¼Œé‡å•Ÿç¨‹å¼å¾Œç”Ÿæ•ˆ

- **æ¨™é»ç¬¦è™Ÿæ­£è¦åŒ–**:
  - `punctuation_mode`: "disabled", "to_fullwidth", "to_halfwidth"
  - é è¨­: "disabled"ï¼ˆåœç”¨ï¼‰
  - å½±éŸ¿æ–°å¢é¡Œç›®æ™‚çš„æ¨™é»ç¬¦è™Ÿè™•ç†
  - ä¿®æ”¹å¾Œéœ€é‡å•Ÿç¨‹å¼ç”Ÿæ•ˆ

- **åœ–ç‰‡é—œéµå­—åµæ¸¬**:
  - `auto_detect_image_keywords`: true / false
  - é è¨­: falseï¼ˆåœç”¨ï¼‰
  - å½±éŸ¿æ‰¹é‡ç­”é¡Œå’Œæ‰¹é‡è§£é¡Œæ™‚çš„åœ–ç‰‡ç™¼é€é‚è¼¯
  - ä¿®æ”¹å¾Œç«‹å³ç”Ÿæ•ˆ

- **ğŸš€ ä¸€æ°£å‘µæˆæ¨¡å¼**:
  - `one_shot_mode_enabled`: true / falseï¼ˆé è¨­ falseï¼‰
    - å•Ÿç”¨å¾Œï¼Œæ‰¹é‡åœ–ç‰‡è¾¨è­˜å®Œæˆå¾Œè‡ªå‹•ç­”é¡Œ/è§£é¡Œ
  - `one_shot_action`: "answer" / "note" / "both"ï¼ˆé è¨­ "answer"ï¼‰
    - answer: åƒ…ç­”é¡Œ
    - note: åƒ…è§£é¡Œ
    - both: ç­”é¡Œ+è§£é¡Œ
  - `one_shot_skip_answered`: true / falseï¼ˆé è¨­ trueï¼‰
    - è·³éå·²æœ‰ç­”æ¡ˆçš„é¡Œç›®
  - `one_shot_include_image`: true / falseï¼ˆé è¨­ trueï¼‰
    - è‡ªå‹•ç™¼é€åœ–ç‰‡çµ¦ AI
  - `one_shot_max_concurrent`: 1-10ï¼ˆé è¨­ 3ï¼‰
    - æœ€å¤§ä½µè¡Œä»»å‹™æ•¸ï¼Œå»ºè­° 3-5
  - ä¿®æ”¹å¾Œç«‹å³ç”Ÿæ•ˆï¼ˆä¸éœ€é‡å•Ÿï¼‰

## åŒ¯å‡ºæ ¼å¼

æ–‡å­—æª”åŒ¯å‡ºæ ¼å¼ (`export_to_text()`):
```
1.(A)é¡Œç›®å…§å®¹
A.é¸é …A B.é¸é …B C.é¸é …C D.é¸é …D

2.ç„¡æ­£ç¢ºç­”æ¡ˆçš„é¡Œç›®
A.é¸é …A B.é¸é …B C.é¸é …C D.é¸é …D
```

## ä¿®æ”¹æŒ‡å—

### ä¿®æ”¹ AI Prompt
ç·¨è¼¯ `api_client.py` ç¬¬ 68-91 è¡Œçš„ `prompt` è®Šæ•¸

### æ–°å¢é¡Œç›®å±¬æ€§
1. æ›´æ–° `QuestionDatabase.add_question()` åƒæ•¸
2. ä¿®æ”¹è³‡æ–™çµæ§‹ (ç¬¬ 65-72 è¡Œ)
3. æ›´æ–° UI è¼¸å…¥å…ƒä»¶ (`main.py`)
4. èª¿æ•´åŒ¯å‡ºé‚è¼¯

### æ”¯æ´æ–°çš„åœ–ç‰‡æ ¼å¼
ä¿®æ”¹ `api_client.py` ç¬¬ 44-50 è¡Œçš„ `mime_type` å­—å…¸

### èª¿æ•´åœ–ç‰‡ç¸®æ”¾åƒæ•¸
åœ¨ `question_database.py` çš„ `save_image()` æ–¹æ³•ä¸­ï¼š
- **ä¿®æ”¹çŸ­é‚Šé™åˆ¶**: èª¿æ•´ `max_short_side` åƒæ•¸ï¼ˆé è¨­ 1200ï¼‰
- **ä¿®æ”¹å“è³ª**: èª¿æ•´ `quality` åƒæ•¸ï¼ˆé è¨­ 95ï¼Œç¯„åœ 1-100ï¼‰
- **ä¿®æ”¹æ¼”ç®—æ³•**: æ›´æ› `Image.Resampling` æ¼”ç®—æ³•
  - `LANCZOS`: æœ€é«˜å“è³ªï¼ˆé è¨­ï¼Œé©åˆæ–‡å­—ï¼‰
  - `BICUBIC`: é«˜å“è³ª
  - `BILINEAR`: ä¸­ç­‰å“è³ª
  - `NEAREST`: æœ€å¿«ä½†å“è³ªå·®

ç¯„ä¾‹ï¼š
```python
# æ›´åš´æ ¼çš„å°ºå¯¸é™åˆ¶
img.resize((new_width, new_height), Image.Resampling.LANCZOS)

# æ›´é«˜çš„å£“ç¸®å“è³ª
img.save(dest_path, 'JPEG', quality=98, optimize=True)
```

## èªè¨€è¦æ±‚

- **æ‰€æœ‰æ–°å¢ç¨‹å¼ç¢¼ã€è¨»é‡‹ã€æ–‡ä»¶å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡**
- UI æ–‡å­—ã€éŒ¯èª¤è¨Šæ¯ã€æ—¥èªŒè¼¸å‡ºå‡ç‚ºç¹é«”ä¸­æ–‡
- è®Šæ•¸åç¨±ä½¿ç”¨è‹±æ–‡ï¼Œä½† docstring å’Œè¨»é‡‹ç”¨ç¹é«”ä¸­æ–‡
- AI prompt ä½¿ç”¨ç¹é«”ä¸­æ–‡ä»¥ç¢ºä¿æ­£ç¢ºè­˜åˆ¥ç¹é«”é¡Œç›®

## å¸¸è¦‹é™·é˜±

1. **ID ç·¨è™Ÿ**: é¡Œç›® ID å¾ 1 é–‹å§‹ç·¨è™Ÿï¼Œè€Œé 0
   - `next_id` åˆå§‹å€¼ç‚º 1
   - æ–°è³‡æ–™åº«ã€æ¸…ç©ºè³‡æ–™åº«ã€åŒ¯å…¥ç©ºè³‡æ–™åº«æ™‚éƒ½å¾ 1 é–‹å§‹
   - åŒ¯å…¥é¡Œåº«æ™‚å¿…é ˆé‡æ–°åˆ†é… IDï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨åŸ ID
2. **åŸ·è¡Œç·’å®‰å…¨**: åœ–ç‰‡è™•ç†åœ¨èƒŒæ™¯åŸ·è¡Œç·’ï¼ŒUI æ›´æ–°å¿…é ˆé€é `root.after()`
3. **JSON è§£æ**: AI å›æ‡‰å¯èƒ½åŒ…å« markdown æ¨™è¨˜ï¼Œéœ€æ¸…ç†å¾Œå†è§£æ
4. **æª”æ¡ˆç·¨ç¢¼**: æ‰€æœ‰æª”æ¡ˆæ“ä½œå¿…é ˆæŒ‡å®š `encoding='utf-8'`
5. **è¤‡é¸æ¡†ç‹€æ…‹**: ä½¿ç”¨ `key in correct_answer` è€Œé `== correct_answer`
6. **Hash è¨ˆç®—é †åº**: é¸é … hash å¿…é ˆå°å€¼æ’åºå¾Œè¨ˆç®—ï¼Œä»¥å¿½ç•¥é¸é …é †åº
7. **åœ–ç‰‡è·¯å¾‘**: åœ–ç‰‡å„²å­˜ä½¿ç”¨ç›¸å°è·¯å¾‘ï¼ˆ`images/xxx.jpg`ï¼‰ï¼Œç¢ºä¿è·¨å¹³å°å…¼å®¹
8. **å»é‡è¿”å›å€¼**: `add_question()` ç¾åœ¨è¿”å› `(id, status, similar_list)` ä¸‰å…ƒçµ„
   - `status`: "new", "duplicate", "similar"
   - `similar_list`: è¿‘ä¼¼é¡Œç›®åˆ—è¡¨ `[(é¡Œç›®, ç›¸ä¼¼åº¦), ...]`
9. **æ¬Šé‡ç¸½å’Œ**: `question_weight` + `options_weight` å¿…é ˆç­‰æ–¼ 1.0
10. **é–¾å€¼ç¯„åœ**: `similarity_threshold` å¿…é ˆåœ¨ 0.0-1.0 ä¹‹é–“
11. **ä½‡åˆ—é˜»å¡**: ä½¿ç”¨ `queue.get_nowait()` è€Œé `queue.get()` é¿å…é˜»å¡ä¸»åŸ·è¡Œç·’
12. **å°è©±æ¡†æ¨¡æ…‹**: `ComparisonDialog` ä½¿ç”¨ `grab_set()` ç¢ºä¿ä½¿ç”¨è€…å¿…é ˆè™•ç†å¾Œæ‰èƒ½ç¹¼çºŒ
13. **åœ–ç‰‡æ ¼å¼**: æ‰€æœ‰åœ–ç‰‡çµ±ä¸€å„²å­˜ç‚º .jpgï¼Œå³ä½¿åŸå§‹æ˜¯ .png
14. **åœ–ç‰‡ç¸®æ”¾**: ä½¿ç”¨ LANCZOS æ¼”ç®—æ³•ï¼Œä¸è¦ä½¿ç”¨ NEAREST æˆ– BILINEARï¼ˆæ–‡å­—æœƒæ¨¡ç³Šï¼‰
15. **é€æ˜èƒŒæ™¯**: PNG é€æ˜èƒŒæ™¯æœƒè‡ªå‹•è½‰ç‚ºç™½è‰²ï¼Œç¢ºä¿ JPEG ç›¸å®¹
16. **Pillow ä¾è³´**: å¿…é ˆå®‰è£ Pillow >= 10.0.0ï¼ŒèˆŠç‰ˆæœ¬ `Image.Resampling.LANCZOS` API ä¸åŒ
17. **åœ–ç‰‡é–å®š**: Windows ä¸Šåœ–ç‰‡é–‹å•Ÿå¾Œå¯èƒ½è¢«é–å®šï¼Œæ¸…ç†æ¸¬è©¦æª”æ¡ˆæ™‚éœ€è™•ç† PermissionError
18. **æ¨™é»ç¬¦è™Ÿæ­£è¦åŒ–æ™‚æ©Ÿ**: `normalize_punctuation()` å¿…é ˆåœ¨ `calculate_*_hash()` ä¹‹å‰åŸ·è¡Œï¼Œå¦å‰‡å»é‡æœƒå¤±æ•ˆ
19. **ä¸­æ–‡èªå¢ƒåµæ¸¬**: æª¢æŸ¥å‰å¾Œ 2 å­—å…ƒè€Œé 1 å­—å…ƒï¼Œæé«˜åµæ¸¬æº–ç¢ºåº¦
20. **åœ–ç‰‡é—œéµå­—å¤§å°å¯«**: ä½¿ç”¨ `text.lower()` å’Œ `keyword.lower()` ç¢ºä¿ä¸å€åˆ†å¤§å°å¯«æ¯”å°
21. **å…¨å±€è¨­å®šæ¨¡æ…‹**: `GlobalSettingsDialog` å¿…é ˆä½¿ç”¨ `grab_set()` é¿å…ä½¿ç”¨è€…åœ¨è¨­å®šæœªå®Œæˆæ™‚æ“ä½œä¸»è¦–çª—
22. **æ‰¹é‡è™•ç†è¨˜æ†¶é«”**: æ‰¹æ¬¡å¤§å°é è¨­ 10ï¼Œé¿å…å¤§é‡ API è«‹æ±‚é€ æˆè¨˜æ†¶é«”æº¢å‡º
23. **èƒŒæ™¯åŸ·è¡Œç·’ UI æ›´æ–°**: æ‰¹é‡è™•ç†çš„æ—¥èªŒå¿…é ˆé€é `root.after()` æ›´æ–°ï¼Œç›´æ¥å‘¼å«æœƒå°è‡´åŸ·è¡Œç·’éŒ¯èª¤
24. **config.json é è¨­å€¼**: æ–°å¢é…ç½®é …ç›®æ™‚å¿…é ˆåœ¨ç¨‹å¼ç¢¼ä¸­æä¾› `config.get('key', default)` é è¨­å€¼ï¼Œé¿å…èˆŠç‰ˆ config é€ æˆ KeyError
25. **åœ–ç‰‡ä¸Šå‚³å„ªåŒ–**: `encode_image_to_base64()` åœ¨è¨˜æ†¶é«”ä¸­ç¸®æ”¾ï¼Œä¸å½±éŸ¿åŸå§‹æª”æ¡ˆï¼Œç¯€çœ API æˆæœ¬
26. **Lambda é–‰åŒ…é™·é˜±**: `root.after()` ä¸­çš„ lambda å¿…é ˆä½¿ç”¨é è¨­åƒæ•¸æ•ç²è®Šæ•¸å€¼
   - éŒ¯èª¤ï¼š`lambda: self.log(f"çµæœ: {e}")`ï¼ˆ`e` åœ¨ lambda åŸ·è¡Œæ™‚å¯èƒ½å·²è¶…å‡ºä½œç”¨åŸŸï¼‰
   - æ­£ç¢ºï¼š`lambda msg=str(e): self.log(f"çµæœ: {msg}")`
   - é©ç”¨æ–¼æ‰€æœ‰åœ¨èƒŒæ™¯åŸ·è¡Œç·’ä¸­é€é `root.after()` æ›´æ–° UI çš„å ´æ™¯
27. **éœæ…‹æ–¹æ³•å‘¼å«**: `contains_image_keywords()` æ˜¯ `QuestionExtractorApp` çš„éœæ…‹æ–¹æ³•
   - éŒ¯èª¤ï¼š`AnswerClient.contains_image_keywords(text)`
   - æ­£ç¢ºï¼š`self.contains_image_keywords(text)` æˆ– `QuestionExtractorApp.contains_image_keywords(text)`
   - ä¸€æ°£å‘µæˆæ–¹æ³•ä¸­ä½¿ç”¨ `self.contains_image_keywords()` å³å¯
28. **API æ–¹æ³•åç¨±**:
   - `AnswerClient` å…¬é–‹æ–¹æ³•ï¼š`answer_single_question()`, `generate_note_for_question()`, `answer_batch()`
   - éŒ¯èª¤ï¼š`generate_answer()`, `generate_note()`ï¼ˆé€™äº›æ–¹æ³•ä¸å­˜åœ¨ï¼‰
   - æ­£ç¢ºï¼šä½¿ç”¨ä¸Šè¿°ä¸‰å€‹å¯¦éš›å­˜åœ¨çš„æ–¹æ³•
29. **è³‡æ–™åº«æ›´æ–°æ–¹æ³•**:
   - `QuestionDatabase` åªæœ‰ `update_question(question_id, question=None, options=None, correct_answer=None, note=None)`
   - éŒ¯èª¤ï¼š`update_answer()`, `update_note()`ï¼ˆé€™äº›æ–¹æ³•ä¸å­˜åœ¨ï¼‰
   - æ­£ç¢ºï¼š`self.db.update_question(id, correct_answer=answer)` æˆ– `self.db.update_question(id, note=note)`
